<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>APTmpl Web Processor</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h2 class="mb-4">APTmpl Web Processor</h2>

    <form id="mainForm" method="post" class="row g-3">

        <div class="col-md-6">
            <label for="aptmplFile" class="form-label">Upload .aptmpl sample file:</label>
            <input type="file" class="form-control" id="aptmplFile" name="aptmpl">
        </div>

        <div class="col-md-6">
            <label for="templateName" class="form-label">Template Name:</label>
            <input type="text" class="form-control" id="templateName" name="templateName">
        </div>

        <div class="col-md-6">
            <label for="tabName" class="form-label">Tab Name:</label>
            <input type="text" class="form-control" id="tabName" name="tabName">
        </div>

        <div class="col-md-6">
            <label for="propName" class="form-label">Property Name:</label>
            <input type="text" class="form-control" id="propName" name="propName">
        </div>

        <div class="col-md-6">
    <label for="colorMode" class="form-label">Color Mode:</label>
    <select class="form-select" id="colorMode" name="colorMode">
        <option value="random" selected>Random</option>
        <option value="distinct">Distinct</option>
        <option value="green2red">Green â†’ Red</option>
    </select>
</div>

        <div class="col-md-12">
            <label for="values" class="form-label">New Property Values (comma-separated):</label>
            <textarea class="form-control" id="values" name="values" rows="3"></textarea>
        </div>

        <textarea id="filedata" name="filedata" hidden></textarea>

        <div class="col-12">
            <button type="submit" class="btn btn-primary">Generate</button>
        </div>

    </form>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Auto-fill tabName & propName after file upload
document.getElementById('aptmplFile').addEventListener('change', function(e) {
    let file = e.target.files[0];
    if (!file) return;

    let formData = new FormData();
    formData.append('aptmpl', file);

    fetch('/upload_ajax', { method: 'POST', body: formData })
        .then(resp => resp.json())
        .then(data => {
            document.getElementById('tabName').value = data.tabName;
            document.getElementById('propName').value = data.propName;
            document.getElementById('templateName').value = data.templateName;
            document.getElementById('filedata').value = data.filedata;
        });
});

// Submit form and download processed .aptmpl
document.getElementById('mainForm').addEventListener('submit', function(e){
    e.preventDefault();

    let formData = new FormData(this);

    fetch('/process_ajax', { method: 'POST', body: formData })
        .then(resp => resp.blob())
        .then(blob => {
            let a = document.createElement('a');
            a.href = window.URL.createObjectURL(blob);
            a.download = "Reencoded_AppearSet.aptmpl";
            a.click();
        });
});
</script>
</body>
</html>
